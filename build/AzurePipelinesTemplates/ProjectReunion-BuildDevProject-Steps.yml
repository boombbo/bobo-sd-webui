steps:
  - task: NuGetAuthenticate@0
    inputs:
      nuGetServiceConnections: 'OS'

  - task: PowerShell@2
    displayName: 'Switch WIL'
    inputs:
      targetType: 'inline'
      script: |
        $file = '$(Build.SourcesDirectory)\dev\TelemetryTest\packages.config'
        $internalPackage = '$(wilInternalPackage)'
        $internalVersion = '$(wilInternalVersion)'
        $content = [System.IO.File]::ReadAllText($file).Replace("Microsoft.Windows.ImplementationLibrary", $internalPackage)
        [System.IO.File]::WriteAllText($file, $content)
        $content = [System.IO.File]::ReadAllText($file).Replace("1.0.210204.1", $internalVersion)
        [System.IO.File]::WriteAllText($file, $content)

  - task: 333b11bd-d341-40d9-afcf-b32d5ce6f23b@2
    displayName: RestoreNuGetPackages
    inputs:
      restoreSolution: dev\TelemetryTest\packages.config
      feedsToUse: config
      nugetConfigPath: dev\TelemetryTest\nuget.config
      restoreDirectory: packages

  - template: ProjectReunion-BuildProject-Steps.yml
    parameters:
      solutionPath: ProjectReunion.sln
      nugetConfigPath: nuget.config
      appxPackageDir: $(appxPackageDir)
      buildOutputDir: $(buildOutputDir)
      publishDir: $(publishDir)
